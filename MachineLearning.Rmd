---
title: "MachineLearning"
author: "DavidAh"
date: "February 15, 2015"
output: html_document
---
## Executive Summary
The purpose of this paper is to use Machine Learning techniques to analyze the data and from the "Qualitative Activity Recognition of Weight Lifting Exercises" [1] to generate a model that can accurately predict how well the participants in the study performed the exercise. The model is built using Random Forests from the training data and then used to analyze the testing data.  The model was able to accurately predict the 20 test cases in the training data,  with an error rate of 3.2%.  

## Data Analysis
```{r}
library(caret)
library(randomForest)
training_data_file <- tempfile()
download.file(url = "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv", destfile = training_data_file, method = "curl")
train_data <- read.csv(training_data_file, stringsAsFactors = FALSE, na.strings = c("", "NA"))

testing_data_file <- tempfile()
download.file(url = "https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv", destfile = testing_data_file, method = "curl")
validation_data <- read.csv(testing_data_file, stringsAsFactors = FALSE, na.strings = c("", "NA"))

```

## Data Analysis
The data contains many columns that have a large number (>90%) NA entries.  These columns are removed from the data set. Also, the user_name and classe variables are re-typed as factors since they are not measurements.  Lastly, the timestamp columns, the new_window are removed from both the training and the testing data, and the problem_id column is removed from the testing data to make the testing data consistent with the training data.

```{r}
## clean the training data
numRows <- nrow(train_data)
threshold <- numRows * .75
print(threshold)
for ( i in colnames(train_data) ) {
    sum <- 0
    for (j in 1:numRows){
        if (is.na(train_data[j,i]) == 1){
          sum <- sum + 1 
        }
    } 
    
    if ( sum > threshold)
    {
       ## Remove column from both the training and the validation data.
       train_data[,i] <- NULL
       validation_data[,i] <- NULL
    }
}
train_data$user_name <- as.factor(train_data$user_name)
train_data$raw_timestamp_part_1 <- NULL
train_data$raw_timestamp_part_2 <- NULL
train_data$cvtd_timestamp <- NULL
train_data$classe <- as.factor(train_data$classe)
train_data$new_window <- NULL 
          
validation_data$raw_timestamp_part_1 <- NULL
validation_data$raw_timestamp_part_2 <- NULL
validation_data$cvtd_timestamp <- NULL
validation_data$user_name <- as.factor(validation_data$user_name)
validation_data$problem_id <- NULL
validation_data$new_window <- NULL
```

## Cross-validation
To provide cross-validation the training data is split into training and testing data which will provide this analysis with 3 data sets, training, testing and validation.
```{r}
trainIndex = createDataPartition(train_data$classe, p=0.75, list=FALSE)
training= train_data[trainIndex,]
testing = train_data[-trainIndex,]
```

## Model
In their paper, "Qualitative Activity Recognition of Weight Lifting Exercises" [1], Velloso et.al.  they state they used a random forest of 10 trees.  The following R code uses the same approach. The model that's generated by the following R code has an OOB estimate of the error rate 3.09%.  
```{r}
model_rf <- randomForest(classe ~. - X - user_name, data = training, ntree = 10,importance = TRUE)
model_rf

predTest <- predict(model_rf, testing)
predRight <- predTest == testing$classe

predValidation <- predict(model_rf, validation_data)
predValidation
```

## Summary
In summary, using machine learning techniques it's possible to create a model that accurately predicts if an exercise is being performed properly.

## References
[1] Velloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human '13) . Stuttgart, Germany: ACM SIGCHI, 2013.


